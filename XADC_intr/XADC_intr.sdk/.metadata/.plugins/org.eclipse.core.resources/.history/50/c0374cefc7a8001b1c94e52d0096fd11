/************ ELECTRIC GO-KART MAIN ************/
#include <stdio.h>
#include "platform.h"
#include "xparameters.h"
#include "xil_printf.h"
#include "xscugic.h"
#include "xil_exception.h"

// User includes
#include "axiinterface.h"
#include "xadc.h"

// User defines
#define INTC_DEVICE_ID XPAR_SCUGIC_SINGLE_DEVICE_ID
#define XADC_EOS XPS_FPGA0_INT_ID

static void XAdcInterruptHandler(void *CallBackRef);

// User structs


// User variables
XScuGic InterruptController;
XScuGic_Config *IntcConfig;
XAdcPs_Config *XAdcConfigPtr;

XAdcPs XAdc;

u8 Status;
u32 IntrStatus;

int main()
{
    init_platform();

	/*
	 * Initialize the interrupt controller driver so that it is ready to
	 * use.
	 */
	IntcConfig = XScuGic_LookupConfig(INTC_DEVICE_ID);
	if (NULL == IntcConfig) {
		return XST_FAILURE;
	}

	Status = XScuGic_CfgInitialize(&InterruptController, IntcConfig,
					IntcConfig->CpuBaseAddress);
	if (Status != XST_SUCCESS) {
		return XST_FAILURE;
	}


    initXAdc();


	/*
	 * Connect the device driver handler that will be called when an
	 * interrupt for the device occurs, the handler defined above performs
	 * the specific interrupt processing for the device.
	 */
	Status = XScuGic_Connect(&InterruptController, XADC_EOS,
				(Xil_InterruptHandler)XAdcInterruptHandler,
				&XAdc);
	if (Status != XST_SUCCESS) {
		return Status;
	}

	/*
	 * Clear any bits set in the Interrupt Status Register.
	 */
	IntrStatus = XAdcPs_IntrGetStatus(&XAdc);
	XAdcPs_IntrClear(&XAdc, IntrStatus);


	/*
	 * Enable Alarm 0 interrupt for on-chip temperature and Alarm 5
	 * interrupt for on-chip VCCPAUX.
	 */
	XAdcPs_IntrEnable(&XAdc, (XADCPS_INTX_ALM5_MASK | XADCPS_INTX_ALM0_MASK));

	/*
	 * Enable the interrupt for the XADC device.
	 */
	XScuGic_Enable(&InterruptController, XADC_EOS);

	/*
	 * Initialize the exception table.
	 */
	Xil_ExceptionInit();

	/*
	 * Register the interrupt controller handler with the exception table.
	 */
	Xil_ExceptionRegisterHandler(XIL_EXCEPTION_ID_INT,
				(Xil_ExceptionHandler) XScuGic_InterruptHandler,
				&InterruptController);
	/*
	 * Enable exceptions.
	 */
	Xil_ExceptionEnable();


    /************************
     * INSERT CODE HERE
     */

    cleanup_platform();
    return 0;
}

static void XAdcInterruptHandler(void *CallBackRef) {

}
